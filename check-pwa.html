<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PWA –ü—Ä–æ–≤–µ—Ä–∫–∞</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: system-ui, -apple-system, sans-serif;
            background: #1a1a2e;
            color: white;
            padding: 20px;
            min-height: 100vh;
        }
        .container { max-width: 800px; margin: 0 auto; }
        h1 { margin-bottom: 20px; }
        .check {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .check.ok { border-left: 4px solid #00ff00; }
        .check.error { border-left: 4px solid #ff0000; }
        .check.warn { border-left: 4px solid #ffaa00; }
        .icon { font-size: 24px; }
        .status { font-weight: bold; }
        .ok .status { color: #00ff00; }
        .error .status { color: #ff0000; }
        .warn .status { color: #ffaa00; }
        button {
            padding: 12px 24px;
            background: #0078d4;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px 10px 0;
        }
        button:hover { background: #106ebe; }
        pre {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 12px;
            margin: 10px 0;
        }
        .install-btn {
            background: linear-gradient(135deg, #0078d4, #00bcf2);
            font-size: 18px;
            padding: 16px 32px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç PWA –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</h1>
        <p style="margin-bottom: 20px; opacity: 0.8;">–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ PWA</p>
        
        <div id="checks"></div>
        
        <div style="margin-top: 30px;">
            <button class="install-btn" id="install-btn" style="display: none;">üì• –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</button>
            <button onclick="location.href='index.html'">üè† –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é</button>
            <button onclick="location.reload()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
        </div>
        
        <div id="debug-info" style="margin-top: 30px;"></div>
    </div>
    
    <script>
        let deferredPrompt = null;
        
        async function runChecks() {
            const checksEl = document.getElementById('checks');
            const checks = [];
            
            // 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ HTTPS
            const isHttps = window.location.protocol === 'https:' || window.location.hostname === 'localhost';
            checks.push({
                name: 'HTTPS —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ',
                ok: isHttps,
                message: isHttps ? '–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è HTTPS' : '–¢—Ä–µ–±—É–µ—Ç—Å—è HTTPS –¥–ª—è PWA (–∏–ª–∏ localhost)',
                warn: !isHttps && window.location.protocol === 'file:'
            });
            
            // 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ Service Worker
            let swSupported = 'serviceWorker' in navigator;
            checks.push({
                name: 'Service Worker',
                ok: swSupported,
                message: swSupported ? '–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –±—Ä–∞—É–∑–µ—Ä–æ–º' : '–ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —ç—Ç–∏–º –±—Ä–∞—É–∑–µ—Ä–æ–º'
            });
            
            // 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ manifest.json
            let manifestOk = false;
            let manifestData = null;
            try {
                const response = await fetch('manifest.json');
                if (response.ok) {
                    manifestData = await response.json();
                    manifestOk = true;
                }
            } catch (e) {
                manifestOk = false;
            }
            
            checks.push({
                name: 'manifest.json',
                ok: manifestOk,
                message: manifestOk ? '–ù–∞–π–¥–µ–Ω –∏ –≤–∞–ª–∏–¥–µ–Ω' : '–ù–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –æ—à–∏–±–∫–∞',
                details: manifestData ? `name: ${manifestData.name}, start_url: ${manifestData.start_url}, display: ${manifestData.display}` : ''
            });
            
            // 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∫–æ–Ω–æ–∫
            let iconsOk = manifestData && manifestData.icons && manifestData.icons.length > 0;
            checks.push({
                name: '–ò–∫–æ–Ω–∫–∏ –¥–ª—è PWA',
                ok: iconsOk,
                message: iconsOk ? `–ù–∞–π–¥–µ–Ω–æ ${manifestData.icons.length} –∏–∫–æ–Ω–æ–∫` : '–ò–∫–æ–Ω–∫–∏ –Ω–µ —É–∫–∞–∑–∞–Ω—ã –≤ manifest.json'
            });
            
            // 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ display —Ä–µ–∂–∏–º–∞
            let displayOk = manifestData && ['fullscreen', 'standalone', 'minimal-ui'].includes(manifestData.display);
            checks.push({
                name: '–†–µ–∂–∏–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è',
                ok: displayOk,
                message: displayOk ? `–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω "${manifestData.display}"` : '–†–µ–∂–∏–º –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç PWA'
            });
            
            // 6. beforeinstallprompt —Å–æ–±—ã—Ç–∏–µ
            let installEventAvailable = false;
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                installEventAvailable = true;
                document.getElementById('install-btn').style.display = 'block';
            }, { once: true });
            
            // –ñ–¥—ë–º –Ω–µ–º–Ω–æ–≥–æ –¥–ª—è —Å–æ–±—ã—Ç–∏—è
            await new Promise(resolve => setTimeout(resolve, 500));
            
            checks.push({
                name: '–°–æ–±—ã—Ç–∏–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏',
                ok: installEventAvailable,
                message: installEventAvailable ? '–î–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è —ç—Ç–æ–≥–æ –±—Ä–∞—É–∑–µ—Ä–∞' : '–ë—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫—É (iOS Safari?)',
                warn: !installEventAvailable
            });
            
            // 7. –ü—Ä–æ–≤–µ—Ä–∫–∞ User Agent
            const ua = navigator.userAgent;
            const isIOS = /iPad|iPhone|iPod/.test(ua) && !window.MSStream;
            const isAndroid = /Android/.test(ua);
            
            checks.push({
                name: '–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞',
                ok: true,
                message: isIOS ? 'iOS Safari' : isAndroid ? 'Android' : 'Desktop',
                details: ua.substring(0, 100) + '...'
            });
            
            // iOSÁâπÂà´ËØ¥Êòé
            if (isIOS) {
                checks.push({
                    name: 'üì± iOS –£—Å—Ç–∞–Ω–æ–≤–∫–∞',
                    ok: false,
                    message: 'iOS Safari –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —É—Å—Ç–∞–Ω–æ–≤–∫—É PWA',
                    details: '–ù–∞–∂–º–∏—Ç–µ "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è" (‚¨ÜÔ∏è) ‚Üí "–ù–∞ —ç–∫—Ä–∞–Ω ¬´–î–æ–º–æ–π¬ª" –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏',
                    warn: true
                });
            }
            
            // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –ø—Ä–æ–≤–µ—Ä–æ–∫
            checksEl.innerHTML = checks.map(check => `
                <div class="check ${check.ok ? 'ok' : check.warn ? 'warn' : 'error'}">
                    <span class="icon">${check.ok ? '‚úÖ' : check.warn ? '‚ö†Ô∏è' : '‚ùå'}</span>
                    <div>
                        <div class="status">${check.name}</div>
                        <div style="opacity: 0.8; font-size: 14px;">${check.message}</div>
                        ${check.details ? `<pre>${check.details}</pre>` : ''}
                    </div>
                </div>
            `).join('');
            
            // Debug –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
            document.getElementById('debug-info').innerHTML = `
                <h3>üìä –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                <pre>
URL: ${window.location.href}
Protocol: ${window.location.protocol}
Hostname: ${window.location.hostname}
User Agent: ${navigator.userAgent}
Language: ${navigator.language}
Platform: ${navigator.platform}
Online: ${navigator.onLine}
Service Worker: ${'serviceWorker' in navigator}
BeforeInstallPrompt: ${deferredPrompt !== null}
                </pre>
            `;
            
            // –ö–Ω–æ–ø–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
            const installBtn = document.getElementById('install-btn');
            installBtn.onclick = async () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    console.log('User choice:', outcome);
                    deferredPrompt = null;
                    installBtn.style.display = 'none';
                }
            };
        }
        
        // –ó–∞–ø—É—Å–∫ –ø—Ä–æ–≤–µ—Ä–æ–∫
        runChecks();
    </script>
</body>
</html>
